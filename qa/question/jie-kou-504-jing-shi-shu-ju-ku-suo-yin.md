---
description: 查询的字段必须建立索引
---

# 接口 504 竟是数据库索引

### 问题描述：

数据库使用率在 10% ，所以对数据库进行降配，但是第二天某个接口出现 504 超时，(超时时间 60s (postman)，在服务器增加超市时间为 300s 后依旧会超时。)但是并不是所有的请求都是超时。

### 问题排查

接口中基本都是数据库查询操作，通过使用二分法打断点来进行调试。（针对服务器在线上的问题，可以采用先将改服务退出负载均衡器，这样正常用户的请求就不回走到这台服务器。）

发现在某一个 sql 查询处卡住了，经过查询发现该表的数据量大概在3000万条，手动查询也会超时。

### 结论

某一个数据库，在where 条件中根据 uid 进行查询，但是数据库中却没有对该字段建立索引。导致进行全表扫描，如果该用户的信息刚好在查询的开始，就不会超时。正确应该在所有where的列都建立索引。
